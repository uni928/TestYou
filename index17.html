<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>数を大きくしていくゲーム</title>
<style>
    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 0;
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
    }
    .game-container {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        padding: 24px 28px 28px;
        max-width: 520px;
        width: 100%;
    }
    h1 {
        margin: 0 0 12px;
        font-size: 1.3rem;
        text-align: center;
    }
    .description {
        font-size: 0.9rem;
        color: #555;
        margin-bottom: 16px;
    }
    .label-row {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #666;
        margin-bottom: 4px;
    }
    .number-display {
        background: #111;
        color: #0ff;
        padding: 10px 12px;
        border-radius: 8px;
        font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.95rem;
        word-break: break-all;
        margin-bottom: 14px;
    }
    .status-row {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #444;
        margin-bottom: 10px;
    }
    .options-title {
        font-size: 0.9rem;
        margin: 8px 0 6px;
    }
    .options {
        display: grid;
        grid-template-columns: repeat(1, minmax(0, 1fr));
        gap: 8px;
    }
    .option-btn {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #ddd;
        background: #fafafa;
        cursor: pointer;
        text-align: left;
        font-size: 0.85rem;
        transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
        font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .option-btn:hover {
        background: #f0f8ff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        transform: translateY(-1px);
    }
    .option-btn:active {
        transform: translateY(0);
        box-shadow: none;
    }
    .controls {
        margin-top: 14px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        flex-wrap: wrap;
    }
    .controls button {
        flex: 1 1 48%;
        padding: 8px 10px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
    }
    .btn-reset {
        background: #eee;
    }
    .btn-reset:hover {
        background: #e0e0e0;
    }
    .btn-hard {
        background: #ffebee;
    }
    .btn-hard:hover {
        background: #ffcdd2;
    }
    .note {
        margin-top: 8px;
        font-size: 0.8rem;
        color: #777;
        line-height: 1.4;
    }
    @media (min-width: 640px) {
        .options {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    }
</style>
</head>
<body>

<div class="game-container">
    <h1>数を大きくしていくゲーム</h1>
    <p class="description">
        最初は 100 からスタートします。  
        毎ターン、現在の数値の <strong>0.95倍〜1.05倍</strong> の中から
        ランダムに5個の候補が現れます。  
        好きな数を選んで、どんどん巨大な数に育ててください。
    </p>

    <div class="label-row">
        <span>現在の数値</span>
        <span>10桁以内は通常表示</span>
    </div>
    <div id="currentValue" class="number-display">-</div>

    <div class="status-row">
        <span>ターン：<span id="turnCount">0</span></span>
        <span>最大値：<span id="maxValueLabel">-</span></span>
    </div>

    <div class="options-title">候補を選んでください：</div>
    <div id="options" class="options"></div>

    <div class="controls">
        <button class="btn-reset" id="resetBtn">リセット（100に戻す）</button>
        <button class="btn-hard" id="hardBtn">ハードモード開始</button>
    </div>

    <p class="note">
        ※巨大数は「1.2345678901 × 10の123乗」形式になります。<br>
        ※ハードモードでは0.90〜1.10倍になります。
    </p>
</div>

<script>
(function() {
    let current = { mantissa: 1, exponent: 2 }; // 100
    let maxValue = { mantissa: 1, exponent: 2 };
    let turnCount = 0;
    let hardMode = false;

    const currentValueEl = document.getElementById('currentValue');
    const optionsEl = document.getElementById('options');
    const turnCountEl = document.getElementById('turnCount');
    const maxValueLabelEl = document.getElementById('maxValueLabel');
    const resetBtn = document.getElementById('resetBtn');
    const hardBtn = document.getElementById('hardBtn');

    function normalize(mantissa, exponent) {
        if (mantissa === 0) return { mantissa: 0, exponent: 0 };
        while (Math.abs(mantissa) >= 10) {
            mantissa /= 10;
            exponent += 1;
        }
        while (Math.abs(mantissa) < 1) {
            mantissa *= 10;
            exponent -= 1;
        }
        return { mantissa, exponent };
    }

    // ★ 10桁以内ならそのまま表示
    function formatScientific(val) {
        const m = val.mantissa;
        const e = val.exponent;

        if (e >= 0 && e <= 9) {
            let normal = m * Math.pow(10, e);
            let str = Math.round(normal).toString();
            if (str.length <= 10) {
                return str;
            }
        }
        return m.toFixed(10) + " × 10の" + e + "乗";
    }

    function compareValue(a, b) {
        if (a.exponent !== b.exponent) return a.exponent > b.exponent ? 1 : -1;
        if (a.mantissa > b.mantissa) return 1;
        if (a.mantissa < b.mantissa) return -1;
        return 0;
    }

    function updateDisplay() {
        currentValueEl.textContent = formatScientific(current);
        maxValueLabelEl.textContent = formatScientific(maxValue);
        turnCountEl.textContent = turnCount;
        generateOptions();
    }

    function generateOptions() {
        optionsEl.innerHTML = "";

        let options = [];
        let hasGreater = false;

        const minFactor = hardMode ? 0.90 : 0.95;
        const maxFactor = hardMode ? 1.10 : 1.05;

        for (let i = 0; i < 5; i++) {
            let factor = minFactor + (maxFactor - minFactor) * Math.random();
            if (factor > 1) hasGreater = true;

            let m = current.mantissa * factor;
            let e = current.exponent;
            const normalized = normalize(m, e);

            options.push({
                value: normalized
            });
        }

        if (!hasGreater) {
            const factor = 1.0 + (maxFactor - 1.0) * Math.random();
            let m = current.mantissa * factor;
            let e = current.exponent;
            const normalized = normalize(m, e);
            options[options.length - 1] = { value: normalized };
        }

        for (let i = options.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [options[i], options[j]] = [options[j], options[i]];
        }

        options.forEach((opt) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `${formatScientific(opt.value)}`;
            btn.addEventListener('click', () => chooseOption(opt.value));
            optionsEl.appendChild(btn);
        });
    }

    function chooseOption(newValue) {
        current = normalize(newValue.mantissa, newValue.exponent);
        turnCount++;

        if (compareValue(current, maxValue) > 0) {
            maxValue = { mantissa: current.mantissa, exponent: current.exponent };
        }
        updateDisplay();
    }

    function resetGame() {
        current = { mantissa: 1, exponent: 2 };
        maxValue = { mantissa: 1, exponent: 2 };
        turnCount = 0;
        hardMode = false;
        hardBtn.textContent = "ハードモード開始";
        updateDisplay();
    }

    function toggleHardMode() {
        hardMode = !hardMode;
        hardBtn.textContent = hardMode ? "ハードモード中（0.90〜1.10）" : "ハードモード開始";
        generateOptions();
    }

    resetBtn.addEventListener('click', resetGame);
    hardBtn.addEventListener('click', toggleHardMode);

    updateDisplay();
})();
</script>

</body>
</html>
