<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>URL â†’ QRã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #0f172a, #1d3557, #22c55e);
      --card-bg: rgba(15, 23, 42, 0.92);
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --radius-xl: 1.5rem;
      --shadow-strong: 0 24px 60px rgba(0, 0, 0, 0.45);
      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 32px;
      background: radial-gradient(
          circle at top left,
          rgba(34, 197, 94, 0.1),
          transparent 60%
        ),
        radial-gradient(
          circle at bottom right,
          rgba(59, 130, 246, 0.15),
          transparent 55%
        );
      padding: 32px;
      border-radius: 2rem;
      box-shadow: var(--shadow-strong);
      border: 1px solid rgba(148, 163, 184, 0.25);
      backdrop-filter: blur(24px);
    }

    @media (max-width: 780px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
        padding: 24px;
      }
    }

    .panel {
      background: radial-gradient(
          circle at top,
          rgba(148, 163, 184, 0.12),
          transparent 60%
        ),
        var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 24px 24px 22px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top right,
        rgba(34, 197, 94, 0.18),
        transparent 55%
      );
      opacity: 0.5;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    /* å·¦ãƒ‘ãƒãƒ«ï¼ˆå…¥åŠ›å´ï¼‰ */

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      letter-spacing: 0.11em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.7);
    }

    h1 {
      margin: 0 0 4px;
      font-size: clamp(22px, 2.2vw + 10px, 30px);
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 22px;
      line-height: 1.5;
    }

    .input-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .input-group {
      position: relative;
      margin-bottom: 18px;
    }

    .input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      opacity: 0.85;
      pointer-events: none;
    }

    .url-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 12px 44px 12px 40px;
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      font-size: 14px;
      outline: none;
      transition: border-color var(--transition-fast),
        box-shadow var(--transition-fast), background var(--transition-fast),
        transform var(--transition-fast);
    }

    .url-input::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    .url-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.3),
        0 18px 40px rgba(15, 23, 42, 0.8);
      background: rgba(15, 23, 42, 0.96);
      transform: translateY(-1px);
    }

    .helper-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 18px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .helper-row span strong {
      color: #e5e7eb;
    }

    .preset-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .preset-btn {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), transform var(--transition-fast),
        color var(--transition-fast), box-shadow var(--transition-fast);
      white-space: nowrap;
    }

    .preset-btn:hover {
      background: rgba(34, 197, 94, 0.14);
      border-color: rgba(34, 197, 94, 0.6);
      color: #e5e7eb;
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
    }

    .preset-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
    }

    .preset-btn:nth-child(2) .preset-dot {
      background: #22c55e;
    }
    .preset-btn:nth-child(3) .preset-dot {
      background: #3b82f6;
    }

    .btn-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .primary-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 11px 16px;
      background: radial-gradient(
          circle at top left,
          rgba(255, 255, 255, 0.16),
          transparent
        ),
        linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 16px 30px rgba(22, 163, 74, 0.6);
      transition: transform var(--transition-fast),
        box-shadow var(--transition-fast), filter var(--transition-fast);
      -webkit-tap-highlight-color: transparent;
    }

    .primary-btn span.icon {
      font-size: 17px;
      transform-origin: center;
      transition: transform 0.22s ease-out;
    }

    .primary-btn:hover {
      transform: translateY(-1.5px) scale(1.01);
      box-shadow: 0 22px 60px rgba(22, 163, 74, 0.7);
      filter: saturate(1.1);
    }

    .primary-btn:hover span.icon {
      transform: translateX(2px);
    }

    .primary-btn:active {
      transform: translateY(0) scale(0.99);
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.7);
      filter: saturate(0.96);
    }

    .primary-btn:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
      filter: grayscale(0.2);
    }

    .secondary-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      font-size: 11px;
      padding: 8px 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), transform var(--transition-fast),
        color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .secondary-btn:hover {
      background: rgba(30, 64, 175, 0.6);
      border-color: rgba(129, 140, 248, 0.9);
      color: #e5e7eb;
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
    }

    .secondary-btn span.icon {
      font-size: 13px;
    }

    .url-preview {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      border-radius: 12px;
      padding: 8px 11px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
      max-height: 68px;
      overflow: auto;
      word-break: break-all;
      margin-bottom: 2px;
    }

    .url-preview span.highlight {
      color: #e5e7eb;
    }

    .hint-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .hint-pill {
      border-radius: 999px;
      padding: 4px 8px;
      background: var(--accent-soft);
      color: #bbf7d0;
      font-size: 10px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .error-msg {
      margin-top: 6px;
      font-size: 11px;
      color: var(--danger);
      min-height: 1em;
    }

    /* å³ãƒ‘ãƒãƒ«ï¼ˆQRçµæœå´ï¼‰ */

    .qr-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
    }

    .qr-title {
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qr-title-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #bbf7d0, #22c55e);
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.9);
    }

    .qr-meta {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .qr-meta span strong {
      color: #e5e7eb;
    }

    .qr-meta-pill {
      border-radius: 999px;
      padding: 4px 9px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 10px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .qr-stage {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 20px;
      padding: 18px 16px 16px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9),
        0 22px 60px rgba(15, 23, 42, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }

    /* â˜… ã“ã“ã‚’çœŸã£ç™½ãªæ ã«å¤‰æ›´ â˜… */
    .qr-inner-ring {
      position: relative;
      width: min(260px, 70vw);
      aspect-ratio: 1 / 1;
      border-radius: 32px;
      padding: 18px;
      background: #ffffff; /* QRã®å‘¨ã‚Šã‚’ç™½ã« */
      box-shadow:
        0 0 0 1px rgba(148, 163, 184, 0.4),
        0 18px 40px rgba(15, 23, 42, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .qr-inner-ring::before {
      content: "";
      position: absolute;
      inset: 10px;
      border-radius: 26px;
      border: 1px dashed rgba(209, 213, 219, 0.9);
      pointer-events: none;
    }

    .qr-placeholder {
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
      padding: 12px;
      line-height: 1.6;
    }

    .qr-placeholder span {
      display: block;
      font-size: 10px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: 4px;
      color: rgba(148, 163, 184, 0.9);
    }

    /* â˜… QRã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã‚‚ç™½èƒŒæ™¯ ï¼‹ ä½™ç™½ä»˜ã â˜… */
    #qrcode {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      border-radius: 24px;
      padding: 8px;
    }

    #qrcode canvas,
    #qrcode img,
    #qrcode table {
      max-width: 100%;
      max-height: 100%;
    }

    .qr-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .qr-actions button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-muted);
      padding: 6px 10px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), transform var(--transition-fast),
        color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .qr-actions button:hover:not(:disabled) {
      background: rgba(15, 118, 110, 0.8);
      border-color: rgba(45, 212, 191, 0.95);
      color: #e5e7eb;
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
    }

    .qr-actions button:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .qr-actions button .icon {
      font-size: 13px;
    }

    .qr-note {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      line-height: 1.6;
    }

    .qr-note strong {
      color: #e5e7eb;
    }

    .footer {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px solid rgba(15, 23, 42, 0.7);
      font-size: 10px;
      color: rgba(148, 163, 184, 0.8);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .footer span {
      opacity: 0.9;
    }

    .footer a {
      color: rgba(203, 213, 225, 0.9);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      .panel {
        padding: 18px 16px 16px;
      }
      .btn-row {
        flex-direction: column;
      }
      .secondary-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <!-- å·¦ï¼šURLå…¥åŠ›ã‚¨ãƒªã‚¢ -->
    <section class="panel">
      <div class="panel-inner">
        <div class="badge">
          <span class="badge-dot"></span>
          URL TO QR Â· INSTANT
        </div>
        <h1>URLã‹ã‚‰ QR ã‚³ãƒ¼ãƒ‰ã‚’ã€‚</h1>
        <p class="subtitle">
          å…±æœ‰ã—ãŸã„ãƒšãƒ¼ã‚¸ã®URLã‚’å…¥åŠ›ã—ã¦ã€ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚<br />
          ååˆºãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ»åº—é ­POPãªã©ã€ã©ã“ã«ã§ã‚‚ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘OKã€‚
        </p>

        <div class="input-label">1. URL ã‚’å…¥åŠ›</div>
        <div class="input-group">
          <span class="input-icon">ğŸ”—</span>
          <input
            id="urlInput"
            type="text"
            class="url-input"
            placeholder="ä¾‹ï¼‰https://example.com/landing"
            autocomplete="off"
          />
        </div>

        <div class="helper-row">
          <span>æœ€å¾Œã«ç”Ÿæˆã—ãŸ URL ã‚’ <strong>ä¸‹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</strong> ã«è¡¨ç¤ºã—ã¾ã™ã€‚</span>
          <div class="preset-row">
            <button class="preset-btn" type="button" data-url="https://www.google.com">
              <span class="preset-dot"></span>
              Google
            </button>
            <button class="preset-btn" type="button" data-url="https://www.youtube.com">
              <span class="preset-dot"></span>
              YouTube
            </button>
            <button class="preset-btn" type="button" data-url="https://www.wikipedia.org">
              <span class="preset-dot"></span>
              Wikipedia
            </button>
          </div>
        </div>

        <div class="btn-row">
          <button id="generateBtn" class="primary-btn" type="button" disabled>
            <span class="icon">â—</span>
            <span>QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ</span>
          </button>
          <button id="clearBtn" class="secondary-btn" type="button">
            <span class="icon">âœ•</span>
            ã‚¯ãƒªã‚¢
          </button>
        </div>

        <div id="urlPreview" class="url-preview">
          å…¥åŠ›ã•ã‚ŒãŸ URL ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        </div>

        <div class="hint-row">
          <div class="hint-pill">Tips</div>
          <span>Enterã‚­ãƒ¼ã§ã‚‚ç”Ÿæˆã§ãã¾ã™ã€‚URLãŒ <strong>http(s)://</strong> ã‹ã‚‰å§‹ã¾ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</span>
        </div>

        <div id="errorMsg" class="error-msg"></div>
      </div>
    </section>

    <!-- å³ï¼šQRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <section class="panel">
      <div class="panel-inner">
        <div class="qr-header">
          <div class="qr-title">
            <span class="qr-title-dot"></span>
            QR PREVIEW
          </div>
          <div class="qr-meta">
            <span class="qr-meta-pill">Vector-Quality</span>
            <span>ã‚µã‚¤ã‚º: <strong>è‡ªå‹•èª¿æ•´</strong></span>
          </div>
        </div>

        <div class="qr-stage">
          <div class="qr-inner-ring">
            <div id="qrcode">
              <div class="qr-placeholder">
                ã¾ã QRã‚³ãƒ¼ãƒ‰ã¯ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br />
                å·¦å´ã«URLã‚’å…¥åŠ›ã—ã¦<br />ã€ŒQRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
                <span>READY TO ENCODE</span>
              </div>
            </div>
          </div>

          <div class="qr-actions">
            <button id="downloadPngBtn" type="button" disabled>
              <span class="icon">â¬‡</span>
              PNGã¨ã—ã¦ä¿å­˜
            </button>
            <button id="copyDataUrlBtn" type="button" disabled>
              <span class="icon">ğŸ“‹</span>
              ç”»åƒãƒ‡ãƒ¼ã‚¿URLã‚’ã‚³ãƒ”ãƒ¼
            </button>
          </div>

          <div class="qr-note">
            ç”Ÿæˆã•ã‚ŒãŸQRã‚³ãƒ¼ãƒ‰ã¯ã€<strong>å°åˆ·ç‰©</strong>ã‚„<strong>ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™</strong>ã«ã‚‚ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã§ãã¾ã™ã€‚<br />
            èª­ã¿å–ã‚Šç²¾åº¦ã‚’é«˜ã‚ã‚‹ãŸã‚ã€èƒŒæ™¯ã¯ã§ãã‚‹ã ã‘ <strong>ç™½</strong> ã«è¿‘ã„å ´æ‰€ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚
          </div>
        </div>

        <div class="footer">
          <span>ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ã§å‹•ä½œã—ã€å…¥åŠ›ã—ãŸURLã¯å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</span>
          <span>Made with <span style="color:#22c55e;">â—†</span> by QR Generator</span>
        </div>
      </div>
    </section>
  </main>

  <script>
    const urlInput = document.getElementById("urlInput");
    const generateBtn = document.getElementById("generateBtn");
    const clearBtn = document.getElementById("clearBtn");
    const urlPreview = document.getElementById("urlPreview");
    const errorMsg = document.getElementById("errorMsg");
    const qrcodeContainer = document.getElementById("qrcode");
    const downloadPngBtn = document.getElementById("downloadPngBtn");
    const copyDataUrlBtn = document.getElementById("copyDataUrlBtn");
    const presetButtons = document.querySelectorAll(".preset-btn");

    let qrInstance = null;
    let lastUrl = "";

    function looksLikeUrl(str) {
      const trimmed = str.trim();
      if (!trimmed) return false;
      // http(s) æ¨å¥¨
      if (trimmed.startsWith("http://") || trimmed.startsWith("https://")) {
        return true;
      }
      // ç°¡æ˜“çš„ã« "xxx.yyy" å½¢å¼ã‚’è¨±å¯ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ãªã©ï¼‰
      return /^[\w.-]+\.[a-z]{2,}$/i.test(trimmed);
    }

    function updatePreview(text) {
      if (!text.trim()) {
        urlPreview.textContent = "å…¥åŠ›ã•ã‚ŒãŸ URL ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
        return;
      }
      const safe = text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
      urlPreview.innerHTML = `<span class="highlight">${safe}</span>`;
    }

    function setError(message) {
      errorMsg.textContent = message || "";
    }

    function clearQr() {
      if (qrInstance) {
        qrcodeContainer.innerHTML = "";
        qrInstance = null;
      } else {
        qrcodeContainer.innerHTML = "";
      }
      // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å¾©æ´»
      const placeholder = document.createElement("div");
      placeholder.className = "qr-placeholder";
      placeholder.innerHTML =
        'ã¾ã QRã‚³ãƒ¼ãƒ‰ã¯ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br />å·¦å´ã«URLã‚’å…¥åŠ›ã—ã¦<br />ã€ŒQRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<span>READY TO ENCODE</span>';
      qrcodeContainer.appendChild(placeholder);

      downloadPngBtn.disabled = true;
      copyDataUrlBtn.disabled = true;
    }

    function ensureQrInstance() {
      if (!qrInstance) {
        qrcodeContainer.innerHTML = "";
        qrInstance = new QRCode(qrcodeContainer, {
          text: "",
          width: 512,
          height: 512,
          correctLevel: QRCode.CorrectLevel.M,
        });
      }
    }

    function generateQr() {
      const value = urlInput.value.trim();
      if (!value) {
        setError("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        clearQr();
        return;
      }
      if (!looksLikeUrl(value)) {
        setError(
          "URLã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆhttp:// ã¾ãŸã¯ https:// ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼‰ã€‚"
        );
        // å½¢å¼ãŒæ€ªã—ãã¦ã‚‚ã€ã‚ãˆã¦ç”Ÿæˆã¯ç¶šè¡Œ
      } else {
        setError("");
      }

      ensureQrInstance();
      qrInstance.clear();
      qrInstance.makeCode(value);
      lastUrl = value;

      updatePreview(value);
      downloadPngBtn.disabled = false;
      copyDataUrlBtn.disabled = false;
    }

    function getQrCanvas() {
      if (!qrcodeContainer) return null;
      const canvas = qrcodeContainer.querySelector("canvas");
      if (canvas) return canvas;

      // table ã§ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã‚­ãƒ£ãƒ³ãƒã‚¹ã«å¤‰æ›
      const table = qrcodeContainer.querySelector("table");
      if (!table) return null;

      const size = 512;
      const tempCanvas = document.createElement("canvas");
      const ctx = tempCanvas.getContext("2d");
      tempCanvas.width = size;
      tempCanvas.height = size;

      const rows = table.rows.length;
      const cols = table.rows[0]?.cells.length || rows;
      const cellSize = size / rows;

      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0, 0, size, size);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = table.rows[r].cells[c];
          const isDark =
            window.getComputedStyle(cell).backgroundColor === "rgb(0, 0, 0)";
          ctx.fillStyle = isDark ? "#000000" : "#ffffff";
          ctx.fillRect(c * cellSize, r * cellSize, cellSize, cellSize);
        }
      }

      return tempCanvas;
    }

    function downloadPng() {
      const canvas = getQrCanvas();
      if (!canvas) return;

      const link = document.createElement("a");
      link.download = "qrcode.png";
      link.href = canvas.toDataURL("image/png");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function copyDataUrl() {
      const canvas = getQrCanvas();
      if (!canvas) return;
      const dataUrl = canvas.toDataURL("image/png");

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard
          .writeText(dataUrl)
          .then(() => {
            setError("ç”»åƒãƒ‡ãƒ¼ã‚¿URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚");
          })
          .catch(() => {
            setError(
              "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¿…è¦ã§ã‚ã‚Œã°ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿URLã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚"
            );
          });
      } else {
        setError(
          "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã€è‡ªå‹•ã‚³ãƒ”ãƒ¼ãŒã§ãã¾ã›ã‚“ã€‚"
        );
      }
    }

    /* ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾© */

    urlInput.addEventListener("input", () => {
      const value = urlInput.value;
      updatePreview(value);
      setError("");
      generateBtn.disabled = value.trim().length === 0;
    });

    urlInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        if (!generateBtn.disabled) {
          generateQr();
        }
      }
    });

    generateBtn.addEventListener("click", generateQr);

    clearBtn.addEventListener("click", () => {
      urlInput.value = "";
      updatePreview("");
      setError("");
      generateBtn.disabled = true;
      clearQr();
      urlInput.focus();
    });

    presetButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const url = btn.getAttribute("data-url") || "";
        urlInput.value = url;
        updatePreview(url);
        generateBtn.disabled = !url.trim();
        setError("");
        urlInput.focus();
        urlInput.setSelectionRange(url.length, url.length);
      });
    });

    downloadPngBtn.addEventListener("click", downloadPng);
    copyDataUrlBtn.addEventListener("click", copyDataUrl);

    // åˆæœŸçŠ¶æ…‹ã®QRã‚³ãƒ³ãƒ†ãƒŠã‚’æ˜ç¤ºçš„ã«ã‚»ãƒƒãƒˆ
    clearQr();
  </script>
</body>
</html>
