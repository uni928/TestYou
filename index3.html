<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local Multi‑Site Viewer – ローカルHTMLを1ページにまとめて表示</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121833; --panel-2:#0e1430; --text:#eef2ff; --muted:#a6b0d6; --accent:#7aa2ff;
      --border:#233067; --chip:#1a2654; --ok:#2ecc71; --warn:#ffb020; --danger:#ff5c7a;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; color:var(--text); background:radial-gradient(1200px 700px at 10% -10%, #17224e 0, #0b1020 36%), radial-gradient(800px 600px at 90% -20%, #1a284f 0, #0b1020 40%);}    
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(10px); background:color-mix(in oklab, var(--panel) 78%, transparent); border-bottom:1px solid var(--border)}
    .wrap{max-width:1200px; margin:0 auto; padding:16px 20px}.title{display:flex; gap:14px; align-items:center;}
.badge{font-size:12px; color:var(--muted); border:1px solid var(--border); background:var(--chip); padding:3px 8px; border-radius:999px}

.toolbar{display:grid; grid-template-columns:1fr auto; gap:12px; margin-top:12px}
.controls{display:flex; flex-wrap:wrap; gap:8px}
input[type="file"]{display:none}
.btn{appearance:none; border:1px solid var(--border); background:linear-gradient(180deg, #1a2554, #141c3e); color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer; font-weight:600}
.btn:disabled{opacity:.6; cursor:not-allowed}
.btn.secondary{background:linear-gradient(180deg, #141c3e, #0e1430)}
.btn.warn{border-color:#664400; background:linear-gradient(180deg, #3a2a00, #251a00)}
.btn.ghost{background:transparent}

.search{display:flex; align-items:center; gap:8px; background:var(--panel-2); border:1px solid var(--border); border-radius:12px; padding:8px 12px}
.search input{flex:1; background:transparent; border:0; outline:0; color:var(--text)}

main{display:grid; grid-template-columns:280px 1fr; gap:16px; max-width:1200px; margin:16px auto; padding:0 20px}
nav{position:sticky; top:88px; align-self:start; background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:12px; max-height:calc(100dvh - 120px); overflow:auto}
nav h3{margin:6px 8px 8px; font-size:13px; color:var(--muted)}
.list{display:flex; flex-direction:column; gap:6px}
.item{display:flex; gap:8px; align-items:center; padding:8px 10px; border-radius:10px; border:1px solid transparent; cursor:pointer}
.item:hover{background:var(--panel-2); border-color:var(--border)}
.item .dot{width:8px; height:8px; border-radius:999px; background:var(--accent); box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent)}
.item .meta{display:flex; flex-direction:column; gap:2px}
.item .meta .name{font-weight:700; font-size:13px}
.item .meta .sub{font-size:12px; color:var(--muted)}

.drop{border:2px dashed var(--border); border-radius:16px; padding:18px; text-align:center; color:var(--muted); background:color-mix(in oklab, var(--panel) 86%, transparent)}
.drop.dragover{border-color:var(--accent); color:var(--text); box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 20%, transparent)}

.grid{display:grid; gap:16px}
.card{background:var(--panel); border:1px solid var(--border); border-radius:16px; overflow:hidden}
.card header{position:relative; background:linear-gradient(180deg, rgba(122,162,255,.12), rgba(0,0,0,.06)); border-bottom:1px solid var(--border)}
.card .head{display:flex; justify-content:space-between; align-items:center; padding:10px 12px}
.card h2{margin:0; font-size:15px}
.card .sub{color:var(--muted); font-size:12px}
.card .actions{display:flex; gap:8px}
.card .body{padding:0;}
.card iframe{width:100%; border:0; display:block; background:#fff}

.footer-note{max-width:1200px; margin:24px auto 60px; padding:0 20px; color:var(--muted); font-size:13px}

@media (max-width: 960px){
  main{grid-template-columns:1fr}
  nav{position:static; max-height:none}
}

  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <h1 style="margin:0;font-size:20px">Local Multi‑Site Viewer</h1>
        <span class="badge">ローカルHTMLを選択するだけ / 保存不要</span>
      </div>
      <div class="toolbar">
        <label class="btn" for="file-input">HTMLファイルを選ぶ（複数可）</label>
        <div class="controls">
          <button class="btn" id="downloadHtml">このページを保存（.html）</button>
        </div>
      </div>
      <div class="search" style="margin-top:10px">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/></svg>
        <input id="filter" placeholder="タイトル/ファイル名で絞り込み…" />
      </div>
    </div>
  </header>  <input id="file-input" type="file" accept=".html,.htm,text/html" multiple />  <main>
    <nav>
      <h3>読み込んだページ</h3>
      <div class="drop" id="drop">ここに .html をドラッグ＆ドロップ</div>
      <div class="list" id="list"></div>
    </nav><section class="grid" id="grid">
  <!-- cards go here -->
</section>

  </main>  <p class="footer-note">
    注意: 相対パスで外部CSS/画像/JSに依存する保存方式（「完全」保存のフォルダ同梱形式）の場合、単一ファイルとして読み込むと外部リソースが読み込めないことがあります。すべて表示したい場合は、各サイトを「単一ファイルで保存（SingleFile拡張など）」にするか、ローカルサーバ（例: `python -m http.server`）上で各HTMLとその資産を同じ階層に置き、<code>iframe src</code> を相対パスで指定してください。
  </p>  <script>
  (function(){
    const $ = (s, el=document)=>el.querySelector(s);
const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));
    const fileInput = document.getElementById('file-input');
    const grid = document.getElementById('grid');
    const list = document.getElementById('list');
    const drop = document.getElementById('drop');
    const filter = document.getElementById('filter');
    const expandAllBtn = document.getElementById('expandAll');
    const collapseAllBtn = document.getElementById('collapseAll');
    const clearAllBtn = document.getElementById('clearAll');
    const downloadBtn = document.getElementById('downloadHtml');

    let entries = []; // {id, name, title, blobUrl, sectionEl, iframe}

    function uid(){return Math.random().toString(36).slice(2,9)}

    function parseTitle(html){
      const m = /<title[^>]*>([\s\S]*?)<\/title>/i.exec(html);
      if(m){ return decodeHTMLEntities(m[1].trim()).replace(/\s+/g, ' ')}
      // fallback: try h1
      const h1 = /<h1[^>]*>([\s\S]*?)<\/h1>/i.exec(html);
      if(h1){ return stripTags(h1[1]).trim() }
      return '';
    }
    function stripTags(s){ const el=document.createElement('div'); el.innerHTML=s; return el.textContent||'' }
    function decodeHTMLEntities(s){ const el=document.createElement('textarea'); el.innerHTML=s; return el.value }

    function addFiles(fileList){
      const files = Array.from(fileList).filter(f => /\.html?$|text\/html/.test(f.type) || /\.html?$/i.test(f.name));
      if(!files.length) return;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          const html = String(reader.result||'');
          const id = uid();
          const title = parseTitle(html) || file.name;
          const blob = new Blob([html], {type:'text/html'});
          const url = URL.createObjectURL(blob);
          const entry = {id, name:file.name, title, blobUrl:url};
          entries.push(entry);
          renderEntry(entry);
          applyFilter();
        };
        reader.readAsText(file);
      });
    }

    function renderEntry(entry){
      // nav item
      const li = document.createElement('div');
      li.className = 'item';
      li.dataset.entryId = entry.id;
      li.innerHTML = `<span class="dot"></span><div class="meta"><div class="name">${escapeHtml(entry.title||entry.name)}</div><div class="sub">${escapeHtml(entry.name)}</div></div>`;
      li.onclick = () => {
        const sec = document.getElementById('sec-'+entry.id);
        if(sec){ sec.scrollIntoView({behavior:'smooth', block:'start'}); sec.classList.add('pulse'); setTimeout(()=>sec.classList.remove('pulse'), 1200);}
      };
      list.appendChild(li);

      // card
      const sec = document.createElement('article');
      sec.className = 'card';
      sec.id = 'sec-'+entry.id;
      sec.innerHTML = `
        <header>
          <div class="head">
            <div>
              <h2>${escapeHtml(entry.title||entry.name)}</h2>
              <div class="sub">${escapeHtml(entry.name)}</div>
            </div>
            <div class="actions">
              <a class="btn ghost" href="${entry.blobUrl}" target="_blank" rel="noopener">別タブで開く</a>
              <button class="btn secondary" data-action="min">最小化</button>
              <button class="btn" data-action="auto">高さ自動</button>
              <button class="btn" data-action="fit">高さ1000px</button>
              <button class="btn warn" data-action="remove">削除</button>
            </div>
          </div>
        </header>
        <div class="body"><iframe title="${escapeHtml(entry.title||entry.name)}" loading="lazy" referrerpolicy="no-referrer" sandbox="allow-scripts allow-forms allow-modals allow-popups" src="${entry.blobUrl}"></iframe></div>
      `;
      grid.appendChild(sec);
      const iframe = sec.querySelector('iframe');
      entry.sectionEl = sec; entry.iframe = iframe;

      // resize to content height when possible
      iframe.addEventListener('load', () => autoResizeIframe(iframe));

      // action buttons
      sec.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const action = btn.dataset.action;
          if(action==='auto') autoResizeIframe(iframe,true);
          if(action==='fit') iframe.style.height = '1000px';
          if(action==='min') iframe.style.height = '240px';
          if(action==='remove') removeEntry(entry.id);
        });
      });
    }

    function autoResizeIframe(iframe, smooth){
      try{
        const doc = iframe.contentDocument;
        if(!doc) return;
        const h = Math.max(600, doc.documentElement.scrollHeight, doc.body?.scrollHeight||0);
        if(smooth){
          iframe.style.transition = 'height .25s ease';
          requestAnimationFrame(()=>{ iframe.style.height = h + 'px'; setTimeout(()=>iframe.style.transition='', 300); });
        }else{
          iframe.style.height = h + 'px';
        }
      }catch(e){
        // Cross-origin (shouldn't happen for blob URLs). Fallback height
        iframe.style.height = '800px';
      }
    }

    function removeEntry(id){
      const idx = entries.findIndex(e=>e.id===id);
      if(idx===-1) return;
      const [e] = entries.splice(idx,1);
      if(e.sectionEl) e.sectionEl.remove();
      const li = list.querySelector(`[data-entry-id="${id}"]`);
      if(li) li.remove();
      if(e.blobUrl) URL.revokeObjectURL(e.blobUrl);
    }

    function applyFilter(){
      const q = filter.value.trim().toLowerCase();
      entries.forEach(e=>{
        const visible = !q || (e.title+" "+e.name).toLowerCase().includes(q);
        if(e.sectionEl) e.sectionEl.style.display = visible ? '' : 'none';
        const li = list.querySelector(`[data-entry-id="${e.id}"]`);
        if(li) li.style.display = visible ? '' : 'none';
      });
    }

    function clearAll(){
      // revoke all
      entries.forEach(e=> e.blobUrl && URL.revokeObjectURL(e.blobUrl));
      entries = [];
      grid.innerHTML = '';
      list.innerHTML = '';
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
    }

    // ダウンロード（このページを .html として保存）
    function downloadHTML(){
      const doctype = '<!DOCTYPE html>
';
      const html = doctype + document.documentElement.outerHTML;
      const blob = new Blob([html], {type:'text/html;charset=utf-8'});
      const a = document.createElement('a');
      const ts = new Date();
      const y = ts.getFullYear();
      const m = String(ts.getMonth()+1).padStart(2,'0');
      const d = String(ts.getDate()).padStart(2,'0');
      a.href = URL.createObjectURL(blob);
      a.download = `local-multi-site-viewer_${y}${m}${d}.html`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 1000);
    }

    downloadBtn && downloadBtn.addEventListener('click', downloadHTML);

    // Events
    fileInput.addEventListener('change', e => addFiles(e.target.files));
    filter.addEventListener('input', applyFilter);
    expandAllBtn.addEventListener('click', ()=> entries.forEach(e=> e.iframe && autoResizeIframe(e.iframe,true)));
    collapseAllBtn.addEventListener('click', ()=> entries.forEach(e=>{ if(e.iframe) e.iframe.style.height = '240px'; }));
    clearAllBtn.addEventListener('click', clearAll);

    ;['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); drop.classList.add('dragover') }));
    ;['dragleave','drop'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); if(ev==='drop'){ addFiles(e.dataTransfer.files) } drop.classList.remove('dragover') }));

  })();
  </script></body>
</html>
