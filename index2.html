<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>定期券の比較ツール（1ヶ月・3ヶ月・6ヶ月）</title>
  <meta name="description" content="1ヶ月・3ヶ月・6ヶ月定期の価格を入力して、1ヶ月定期と比べてどれだけお得かを表示します。入力はIndexedDBに保存され、次回起動時に自動復元されます。" />
  <style>
    /* ---------- Reset (light) ---------- */
    *, *::before, *::after { box-sizing: border-box; }

    :root{
      --bg1: 255, 255, 255;
      --glass: 255, 255, 255;
      --brand: 86, 100, 255;
      --accent: 0, 179, 167;
      --warn: 238, 77, 77;
      --text: 23, 28, 35;
      --muted: 92, 98, 110;
      --ring: 105, 120, 255;
      --shadow: 17, 19, 24;
    }

    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", "Yu Gothic", "Meiryo", sans-serif;
      color: rgb(var(--text));
      background: radial-gradient(1200px 800px at 10% 10%, rgba(120,125,255,0.15), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(0,200,180,0.18), transparent 65%),
                  linear-gradient(180deg, #f7f8ff 0%, #f2f7f9 100%);
      display: grid;
      place-items: center;
      padding: 32px 16px;
    }

    .container{
      width: min(960px, 100%);
    }

    .card{
      position: relative;
      background: rgba(var(--glass), 0.78);
      backdrop-filter: saturate(160%) blur(14px);
      border: 1px solid rgba(255,255,255,0.6);
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(var(--shadow), 0.08), 0 2px 10px rgba(var(--shadow), 0.04);
      overflow: clip;
    }

    .header{
      padding: 24px 28px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }

    .title{
      font-size: clamp(18px, 2.6vw, 24px);
      font-weight: 800;
      letter-spacing: 0.2px;
      display: flex; align-items: center; gap: 12px;
    }
    .title .logo{
      width: 28px; height: 28px; border-radius: 8px;
      background: linear-gradient(135deg, rgba(var(--brand),1), rgba(var(--accent),1));
      box-shadow: inset 0 0 0 1.5px rgba(255,255,255,0.6), 0 4px 10px rgba(86,100,255,0.35);
    }

    .header-actions{ display:flex; gap: 8px; }
    .btn{
      --bg: 245,247,255;
      --fg: var(--text);
      appearance: none; border: none; cursor: pointer;
      background: rgb(var(--bg)); color: rgb(var(--fg));
      border-radius: 12px; padding: 10px 14px; font-weight: 700;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 2px 8px rgba(var(--shadow),0.05);
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 16px rgba(var(--shadow),0.08); }
    .btn:active{ transform: translateY(0); }
    .btn.primary{ --bg: var(--brand); --fg: 255,255,255; background: linear-gradient(135deg, rgba(var(--brand),1), rgba(120,135,255,1)); }
    .btn.ghost{ background: rgba(255,255,255,0.7); }

    .body{ padding: 26px; display: grid; gap: 22px; }

    .grid{
      display: grid; gap: 16px;
      grid-template-columns: 1fr; 
    }
    @media (min-width: 820px){
      .grid{ grid-template-columns: 1.2fr 0.8fr; }
    }

    .panel{
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 18px; padding: 20px; box-shadow: 0 4px 14px rgba(var(--shadow),0.04);
    }

    .panel h2{ margin: 2px 0 14px; font-size: 16px; letter-spacing: .2px; color: rgb(var(--muted)); }

    .row{ display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: end; }
    .row + .row{ margin-top: 14px; }

    .field{ display: grid; gap: 8px; }
    .label{ font-size: 13px; color: rgb(var(--muted)); font-weight: 700; letter-spacing: .3px; }

    .input-wrap{ position: relative; }
    .yen{ position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: .6; font-weight: 800; }
    input[type="number"]{
      width: 100%; appearance: textfield; -moz-appearance: textfield;
      padding: 14px 14px 14px 32px; border-radius: 12px;
      border: 1.2px solid rgba(0,0,0,0.12); background: #fff;
      font-size: 16px; font-weight: 700;
      outline: none; transition: box-shadow .2s, border-color .2s;
    }
    input[type="number"]:focus{
      border-color: rgba(var(--ring), .85);
      box-shadow: 0 0 0 4px rgba(var(--ring), .18);
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }

    .suffix{ align-self: center; color: rgb(var(--muted)); font-weight: 700; font-size: 13px; }

    .badge{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius: 999px; font-size:12px; font-weight:800; letter-spacing:.2px; }
    .badge.good{ background: rgba(var(--accent), .12); color: rgba(var(--accent), 1); }
    .badge.bad{ background: rgba(var(--warn), .12); color: rgba(var(--warn), 1); }
    .badge.neutral{ background: rgba(0,0,0,.06); color: rgb(var(--muted)); }

    .kpi{
      display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 14px;
    }
    .kpi .tile{
      border-radius: 16px; padding: 16px; background: #fff; border: 1px solid rgba(0,0,0,0.06);
      box-shadow: 0 4px 12px rgba(var(--shadow), .04);
    }
    .kpi .label{ font-size: 12px; color: rgb(var(--muted)); font-weight: 800; letter-spacing: .25px; }
    .kpi .value{ font-size: clamp(18px, 3.4vw, 26px); font-weight: 900; margin-top: 6px; }
    .kpi .sub{ font-size: 12px; color: rgb(var(--muted)); margin-top: 4px; }

    .footnote{ font-size: 12px; color: rgb(var(--muted)); line-height: 1.55; }

    .footer{ padding: 20px 24px 26px; display:flex; justify-content: space-between; align-items:center; gap: 10px; border-top: 1px solid rgba(0,0,0,0.06); }
    .tiny{ font-size: 12px; color: rgb(var(--muted)); }

    .pill{ display:inline-flex; gap:10px; align-items:center; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,.8); border: 1px solid rgba(0,0,0,.06); box-shadow: 0 2px 8px rgba(var(--shadow),.05); font-weight:800; }

    .per-month{ white-space: nowrap; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="定期券比較">
      <div class="header">
        <div class="title"><span class="logo" aria-hidden="true"></span> 定期券の比較ツール <span class="pill">1ヶ月 / 3ヶ月 / 6ヶ月</span></div>
        <div class="header-actions">
          <button class="btn ghost" id="btnReset" title="入力をクリア">リセット</button>
          <button class="btn primary" id="btnSample" title="例を入れる">サンプル値</button>
        </div>
      </div>

      <div class="body">
        <div class="grid">
          <!-- 左：入力 -->
          <section class="panel" aria-labelledby="formTitle">
            <h2 id="formTitle">価格を入力</h2>

            <div class="row">
              <div class="field">
                <label class="label" for="one">1ヶ月定期（合計）</label>
                <div class="input-wrap">
                  <span class="yen">¥</span>
                  <input id="one" type="number" inputmode="numeric" min="0" step="1" placeholder="例: 10,000" />
                </div>
              </div>
              <div class="suffix">/ 1ヶ月</div>
            </div>

            <div class="row">
              <div class="field">
                <label class="label" for="three">3ヶ月定期（合計）</label>
                <div class="input-wrap">
                  <span class="yen">¥</span>
                  <input id="three" type="number" inputmode="numeric" min="0" step="1" placeholder="例: 27,000" />
                </div>
              </div>
              <div class="suffix per-month" id="pm3">/ 1ヶ月 ー 円</div>
            </div>

            <div class="row">
              <div class="field">
                <label class="label" for="six">6ヶ月定期（合計）</label>
                <div class="input-wrap">
                  <span class="yen">¥</span>
                  <input id="six" type="number" inputmode="numeric" min="0" step="1" placeholder="例: 51,000" />
                </div>
              </div>
              <div class="suffix per-month" id="pm6">/ 1ヶ月 ー 円</div>
            </div>

            <p class="footnote" style="margin-top:14px;">※ 3ヶ月・6ヶ月の欄の右に、1ヶ月あたりの参考値を自動表示します。</p>
          </section>

          <!-- 右：結果表示 -->
          <section class="panel" aria-labelledby="resultTitle">
            <h2 id="resultTitle">結果</h2>

            <div class="kpi" aria-live="polite">
              <div class="tile">
                <div class="label">3ヶ月定期の節約額（1ヶ月×3との比較）</div>
                <div class="value" id="save3">ー 円</div>
                <div class="sub" id="rate3">ー</div>
              </div>
              <div class="tile">
                <div class="label">6ヶ月定期の節約額（1ヶ月×6との比較）</div>
                <div class="value" id="save6">ー 円</div>
                <div class="sub" id="rate6">ー</div>
              </div>
            </div>

            <div style="display:grid; gap:10px; margin-top:14px;">
              <span id="badge3" class="badge neutral">3ヶ月定期：計算待ち</span>
              <span id="badge6" class="badge neutral">6ヶ月定期：計算待ち</span>
            </div>

            <p class="footnote" style="margin-top:12px;">計算式：<br>
              ・3ヶ月の節約額 = （1ヶ月価格 × 3） − 3ヶ月価格<br>
              ・6ヶ月の節約額 = （1ヶ月価格 × 6） − 6ヶ月価格
            </p>
          </section>
        </div>
      </div>

      <div class="footer">
        <div class="tiny">入力内容はブラウザの <strong>IndexedDB</strong> に保存されます。</div>
        <div class="tiny">© 定期券の比較ツール</div>
      </div>
    </div>
  </div>

  <script>
    // ===== 通貨フォーマッタ =====
    const JPY = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 });

    // ===== IndexedDB ヘルパ =====
    const DB_NAME = 'seasonpass-db';
    const DB_VER  = 1;
    const STORE   = 'settings';
    const KEY     = 'pricing';

    function openDB(){
      return new Promise((resolve, reject) => {
        const req = indexedDB.open(DB_NAME, DB_VER);
        req.onupgradeneeded = (e) => {
          const db = e.target.result;
          if(!db.objectStoreNames.contains(STORE)){
            db.createObjectStore(STORE, { keyPath: 'id' });
          }
        };
        req.onsuccess = () => resolve(req.result);
        req.onerror   = () => reject(req.error);
      });
    }

    async function saveState(state){
      const db = await openDB();
      await new Promise((resolve, reject) => {
        const tx = db.transaction(STORE, 'readwrite');
        const st = tx.objectStore(STORE);
        st.put({ id: KEY, ...state });
        tx.oncomplete = resolve;
        tx.onerror = () => reject(tx.error);
      });
      db.close();
    }

    async function loadState(){
      const db = await openDB();
      const data = await new Promise((resolve, reject) => {
        const tx = db.transaction(STORE, 'readonly');
        const st = tx.objectStore(STORE);
        const get = st.get(KEY);
        get.onsuccess = () => resolve(get.result || null);
        get.onerror = () => reject(get.error);
      });
      db.close();
      return data;
    }

    // ===== UI ロジック =====
    const $ = (sel) => document.querySelector(sel);
    const one   = $('#one');
    const three = $('#three');
    const six   = $('#six');

    const pm3   = $('#pm3');
    const pm6   = $('#pm6');
    const save3 = $('#save3');
    const save6 = $('#save6');
    const rate3 = $('#rate3');
    const rate6 = $('#rate6');
    const badge3= $('#badge3');
    const badge6= $('#badge6');

    function toNum(v){
      const n = Number(v);
      return Number.isFinite(n) && n >= 0 ? Math.floor(n) : 0;
    }

    function setBadge($el, kind, text){
      $el.className = `badge ${kind}`;
      $el.textContent = text;
    }

    function update(){
      const v1 = toNum(one.value);
      const v3 = toNum(three.value);
      const v6 = toNum(six.value);

      // 1ヶ月あたり
      const p3 = v3 > 0 ? Math.round(v3 / 3) : 0;
      const p6 = v6 > 0 ? Math.round(v6 / 6) : 0;
      pm3.textContent = `/ 1ヶ月 ${p3 ? JPY.format(p3) : 'ー 円'}`;
      pm6.textContent = `/ 1ヶ月 ${p6 ? JPY.format(p6) : 'ー 円'}`;

      if(v1 > 0 && v3 > 0){
        const diff3 = v1*3 - v3;
        const diff3sub = diff3 / 3;
        save3.textContent = JPY.format(diff3) + "(" + JPY.format(diff3sub) + ")";
        const pct3 = ((diff3) / (v1*3)) * 100;
        rate3.textContent = `1ヶ月×3 と比べて ${pct3>=0? '安い' : '高い'}：${pct3? pct3.toFixed(1) : '0.0'}%`;
        setBadge(badge3, diff3>0? 'good' : (diff3<0? 'bad':'neutral'), diff3>0? `3ヶ月定期はお得（${JPY.format(Math.abs(diff3))}安い）` : (diff3<0? `3ヶ月定期は割高（${JPY.format(Math.abs(diff3))}高い）` : '3ヶ月定期：差なし'));
      }else{
        save3.textContent = 'ー 円'; rate3.textContent = 'ー'; setBadge(badge3,'neutral','3ヶ月定期：計算待ち');
      }

      if(v1 > 0 && v6 > 0){
        const diff6 = v1*6 - v6;
        const diff6sub = diff6 / 6;
        save6.textContent = JPY.format(diff6) + "(" + JPY.format(diff6sub) + ")";
        const pct6 = ((diff6) / (v1*6)) * 100;
        rate6.textContent = `1ヶ月×6 と比べて ${pct6>=0? '安い' : '高い'}：${pct6? pct6.toFixed(1) : '0.0'}%`;
        setBadge(badge6, diff6>0? 'good' : (diff6<0? 'bad':'neutral'), diff6>0? `6ヶ月定期はお得（${JPY.format(Math.abs(diff6))}安い）` : (diff6<0? `6ヶ月定期は割高（${JPY.format(Math.abs(diff6))}高い）` : '6ヶ月定期：差なし'));
      }else{
        save6.textContent = 'ー 円'; rate6.textContent = 'ー'; setBadge(badge6,'neutral','6ヶ月定期：計算待ち');
      }

      // 保存
      debounceSave({ one: v1, three: v3, six: v6 });
    }

    let saveTimer = null;
    function debounceSave(state){
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => saveState(state).catch(console.error), 250);
    }

    function bind(){
      [one, three, six].forEach(el => el.addEventListener('input', update));
      $('#btnReset').addEventListener('click', () => {
        one.value = three.value = six.value = '';
        update();
      });
      $('#btnSample').addEventListener('click', () => {
        one.value = 10000; // 1ヶ月
        three.value = 27000; // 3ヶ月
        six.value = 51000; // 6ヶ月
        update();
      });
    }

    async function restore(){
      try{
        const data = await loadState();
        if(data){
          if(Number.isFinite(data.one))   one.value   = data.one;
          if(Number.isFinite(data.three)) three.value = data.three;
          if(Number.isFinite(data.six))   six.value   = data.six;
        }
      }catch(err){ console.warn('IndexedDB 読み込みに失敗:', err); }
      update();
    }

    document.addEventListener('DOMContentLoaded', () => { bind(); restore(); });
  </script>
</body>
</html>

